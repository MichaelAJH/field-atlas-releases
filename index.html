<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Field Atlas — Citation Graph Explorer for Researchers</title>
  <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/icons/favicon-32.png">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #0f1117;
      --surface: #1a1d27;
      --surface-hover: #222632;
      --border: #2a2e3a;
      --text: #e4e4e7;
      --text-muted: #9294a0;
      --accent: #6366f1;
      --accent-hover: #818cf8;
      --green: #22c55e;
      --radius: 10px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    a { color: var(--accent); text-decoration: none; }
    a:hover { color: var(--accent-hover); text-decoration: underline; }

    .container { max-width: 860px; margin: 0 auto; padding: 0 24px; }

    /* ---- Header ---- */
    header {
      position: relative;
      padding: 80px 0 48px;
      text-align: center;
      overflow: hidden;
      width: 100%;
    }
    #graph-canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    .hero-content {
      position: relative;
      z-index: 1;
      max-width: 860px;
      margin: 0 auto;
      padding: 0 24px;
      pointer-events: auto;
    }
    header h1 {
      font-size: 2.8rem;
      font-weight: 700;
      letter-spacing: -0.03em;
      margin-bottom: 12px;
      color: #a5b4fc;
    }
    header .tagline {
      font-size: 1.15rem;
      color: var(--text-muted);
      max-width: 520px;
      margin: 0 auto 40px;
    }

    /* ---- Download buttons ---- */
    .downloads {
      display: flex;
      gap: 14px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 28px;
      border-radius: var(--radius);
      font-size: 0.95rem;
      font-weight: 600;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text);
      cursor: pointer;
      transition: background 0.15s, border-color 0.15s;
    }
    .btn:hover { background: var(--surface-hover); border-color: var(--accent); text-decoration: none; }
    .btn-primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }
    .btn-primary:hover { background: var(--accent-hover); border-color: var(--accent-hover); }
    .version-note {
      text-align: center;
      font-size: 0.82rem;
      color: var(--text-muted);
      margin-bottom: 48px;
    }

    /* ---- Sections ---- */
    section { padding: 40px 0; }
    section + section { border-top: 1px solid var(--border); }
    section h2 {
      font-size: 1.4rem;
      font-weight: 600;
      margin-bottom: 20px;
    }

    /* ---- Quick Start ---- */
    .steps {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
    }
    .step {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
    }
    .step-num {
      display: inline-block;
      width: 28px; height: 28px;
      line-height: 28px;
      text-align: center;
      border-radius: 50%;
      background: var(--accent);
      color: #fff;
      font-size: 0.82rem;
      font-weight: 700;
      margin-bottom: 10px;
    }
    .step h3 { font-size: 0.95rem; font-weight: 600; margin-bottom: 4px; }
    .step p { font-size: 0.85rem; color: var(--text-muted); }

    /* ---- Features ---- */
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
    }
    .feature {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
    }
    .feature h3 { font-size: 0.95rem; font-weight: 600; margin-bottom: 6px; }
    .feature p { font-size: 0.85rem; color: var(--text-muted); }

    /* ---- Requirements ---- */
    .req-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    @media (max-width: 560px) { .req-grid { grid-template-columns: 1fr; } }
    .req-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
    }
    .req-card h3 { font-size: 0.95rem; font-weight: 600; margin-bottom: 6px; }
    .req-card p, .req-card li { font-size: 0.85rem; color: var(--text-muted); }
    .req-card ul { padding-left: 18px; }
    .badge {
      display: inline-block;
      font-size: 0.72rem;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 4px;
      margin-left: 6px;
      vertical-align: middle;
    }
    .badge-required { background: #7c3aed33; color: #a78bfa; }
    .badge-optional { background: #16a34a22; color: #4ade80; }

    /* ---- Footer ---- */
    footer {
      padding: 40px 0;
      border-top: 1px solid var(--border);
      text-align: center;
      font-size: 0.85rem;
      color: var(--text-muted);
    }
    footer .links { margin-bottom: 8px; }
    footer .links a { margin: 0 12px; }

    code {
      background: var(--surface);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.85em;
    }
  </style>
</head>
<body>

  <!-- Header: full-width, outside .container -->
  <header id="hero">
      <canvas id="graph-canvas"></canvas>
      <div class="hero-content">
        <h1>Field Atlas</h1>
        <p class="tagline">
          An interactive citation graph explorer that helps researchers navigate unfamiliar academic fields.
        </p>
        <div class="downloads">
          <a id="dl-mac" class="btn" href="https://github.com/MichaelAJH/field-atlas-releases/releases/latest">
            macOS (.dmg)
          </a>
          <a id="dl-win" class="btn" href="https://github.com/MichaelAJH/field-atlas-releases/releases/latest">
            Windows (.exe)
          </a>
          <a id="dl-linux" class="btn" href="https://github.com/MichaelAJH/field-atlas-releases/releases/latest">
            Linux (.AppImage)
          </a>
        </div>
        <p class="version-note" id="version-note">
          Free &amp; open source &middot;
          <a href="https://github.com/MichaelAJH/field-atlas-releases/releases">All releases</a>
        </p>
      </div>
  </header>

  <div class="container">

    <!-- Quick Start -->
    <section>
      <h2>Quick Start</h2>
      <div class="steps">
        <div class="step">
          <div class="step-num">1</div>
          <h3>Install Ollama</h3>
          <p>Download from <a href="https://ollama.com/download">ollama.com</a>, then run <code>ollama pull llama3</code>.</p>
        </div>
        <div class="step">
          <div class="step-num">2</div>
          <h3>Download Field Atlas</h3>
          <p>Grab the installer for your platform from the buttons above.</p>
        </div>
        <div class="step">
          <div class="step-num">3</div>
          <h3>Launch</h3>
          <p>Open the app. Make sure Ollama is running (<code>ollama serve</code>).</p>
        </div>
        <div class="step">
          <div class="step-num">4</div>
          <h3>Explore</h3>
          <p>Type a research topic and explore the citation graph that appears in seconds.</p>
        </div>
      </div>
    </section>

    <!-- Features -->
    <section>
      <h2>Features</h2>
      <div class="features">
        <div class="feature">
          <h3>Smart Query Expansion</h3>
          <p>Your query is expanded into multiple search variants to discover papers you'd otherwise miss.</p>
        </div>
        <div class="feature">
          <h3>Interactive Citation Graph</h3>
          <p>Force-directed D3.js visualization with chronological layout. Zoom, pan, click to explore.</p>
        </div>
        <div class="feature">
          <h3>AI-Powered Summaries</h3>
          <p>Hover any paper for an LLM-generated summary. Hover an edge to understand citation relationships.</p>
        </div>
        <div class="feature">
          <h3>Structural Analysis</h3>
          <p>PageRank, centrality, clustering, and fundamental paper identification — computed automatically.</p>
        </div>
        <div class="feature">
          <h3>Adjustable Controls</h3>
          <p>Toggle search variants, switch ranking presets (Overview / Balanced / Expert), or fine-tune with sliders.</p>
        </div>
        <div class="feature">
          <h3>Export &amp; Load Sessions</h3>
          <p>Save your entire exploration as JSON. Reload it later to pick up exactly where you left off.</p>
        </div>
      </div>
    </section>

    <!-- System Requirements -->
    <section>
      <h2>System Requirements</h2>
      <div class="req-grid">
        <div class="req-card">
          <h3>Ollama <span class="badge badge-optional">Recommended</span></h3>
          <p>Free, local LLM runtime. Needed for AI summaries and query expansion when using local models.</p>
          <ul>
            <li>~4 GB for one model (llama3, mistral, etc.)</li>
            <li>Not needed if using Claude or OpenAI API keys</li>
          </ul>
        </div>
        <div class="req-card">
          <h3>Disk Space</h3>
          <ul>
            <li>App: ~200 MB</li>
            <li>Sentence-transformer model: ~80 MB (downloads on first run)</li>
            <li>Ollama model: ~4 GB</li>
          </ul>
        </div>
        <div class="req-card">
          <h3>Operating System</h3>
          <ul>
            <li>macOS 11+ (Intel &amp; Apple Silicon)</li>
            <li>Windows 10+</li>
            <li>Linux (glibc 2.31+)</li>
          </ul>
        </div>
        <div class="req-card">
          <h3>Alternative LLM Providers</h3>
          <p>Instead of Ollama you can use:</p>
          <ul>
            <li>Claude (Anthropic API key)</li>
            <li>OpenAI (GPT-4o-mini)</li>
          </ul>
          <p>Configure in app Settings.</p>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer>
      <div class="links">
        <a href="docs/user-guide.md">User Guide</a>
        <a href="docs/troubleshooting.md">Troubleshooting</a>
        <a href="CHANGELOG.md">Changelog</a>
        <a href="https://github.com/MichaelAJH/field-atlas-releases/issues">Report a Bug</a>
      </div>
      <p>Field Atlas is free and open source.</p>
    </footer>

  </div>

  <script>
    // ── Animated graph background ──
    (function () {
      var canvas = document.getElementById('graph-canvas');
      var hero   = document.getElementById('hero');
      var ctx    = canvas.getContext('2d');
      var mouse  = { x: -9999, y: -9999 };

      // ── Physics constants — tune these to adjust feel ──────────────────
      //
      // NODE_COUNT: total number of nodes in the graph.
      //   more → denser, more tangled   |   fewer → sparse, constellation-like
      var NODE_COUNT = 65;

      // LINK_DIST: max pixel distance at which two nodes are connected by an edge.
      //   higher → more edges, tangly web   |   lower → fewer edges, sparse stars
      var LINK_DIST  = 140;

      // REPEL_DIST: radius (px) around the mouse cursor that pushes nodes away.
      //   higher → larger influence zone   |   lower → tighter, more precise
      var REPEL_DIST = 110;

      // REPEL_STR: impulse strength applied when mouse enters REPEL_DIST.
      //   higher → nodes scatter explosively   |   lower → gentle nudge
      var REPEL_STR  = 0.9;

      // SPRING_K: how strongly each node is pulled back toward its home position.
      //   0.000 → pure drift, no recovery (original constellation feel)
      //   0.005 → gentle pull, nodes wander but slowly drift home  ← current
      //   0.015 → snappy, nodes return quickly after mouse push
      var SPRING_K   = 0.005;

      // DAMPING: fraction of velocity kept each frame (applied after spring + repulsion).
      //   0.999 → almost no friction, nodes glide and tangle freely (constellation)
      //   0.980 → light friction, nodes settle after disturbance  ← current
      //   0.900 → heavy friction, very little free drift
      var DAMPING    = 0.980;

      // SPEED_CAP: maximum velocity magnitude a node can reach (px/frame).
      //   higher → nodes can fling far on mouse push
      //   lower  → movement stays subtle
      var SPEED_CAP  = 2.5;
      // ───────────────────────────────────────────────────────────────────
      var nodes = [];

      function resize() {
        canvas.width  = hero.offsetWidth;
        canvas.height = hero.offsetHeight;
        // On resize, update home positions proportionally
        nodes.forEach(function (n) {
          n.ox = n.fx * canvas.width;
          n.oy = n.fy * canvas.height;
        });
      }

      function rand(min, max) { return min + Math.random() * (max - min); }

      function init() {
        canvas.width  = hero.offsetWidth;
        canvas.height = hero.offsetHeight;
        nodes = [];
        for (var i = 0; i < NODE_COUNT; i++) {
          var fx = Math.random();
          var fy = Math.random();
          nodes.push({
            fx: fx, fy: fy,                    // fractional home position
            ox: fx * canvas.width,             // home x (absolute)
            oy: fy * canvas.height,            // home y (absolute)
            x:  fx * canvas.width,
            y:  fy * canvas.height,
            vx: rand(-0.3, 0.3),
            vy: rand(-0.3, 0.3),
            r:  rand(2, 4)
          });
        }
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Edges
        for (var i = 0; i < nodes.length; i++) {
          for (var j = i + 1; j < nodes.length; j++) {
            var dx = nodes[j].x - nodes[i].x;
            var dy = nodes[j].y - nodes[i].y;
            var d  = Math.sqrt(dx * dx + dy * dy);
            if (d < LINK_DIST) {
              var alpha = (1 - d / LINK_DIST) * 0.3;
              ctx.beginPath();
              ctx.moveTo(nodes[i].x, nodes[i].y);
              ctx.lineTo(nodes[j].x, nodes[j].y);
              ctx.strokeStyle = 'rgba(129, 140, 248, ' + alpha + ')';
              ctx.lineWidth   = 1;
              ctx.stroke();
            }
          }
        }

        // Nodes
        for (var i = 0; i < nodes.length; i++) {
          ctx.beginPath();
          ctx.arc(nodes[i].x, nodes[i].y, nodes[i].r, 0, Math.PI * 2);
          ctx.fillStyle = 'rgba(165, 180, 252, 0.6)';
          ctx.fill();
        }
      }

      function update() {
        for (var i = 0; i < nodes.length; i++) {
          var n = nodes[i];

          // Spring: pull back toward home position
          n.vx += (n.ox - n.x) * SPRING_K;
          n.vy += (n.oy - n.y) * SPRING_K;

          // Mouse repulsion
          var mx = n.x - mouse.x;
          var my = n.y - mouse.y;
          var md = Math.sqrt(mx * mx + my * my);
          if (md < REPEL_DIST && md > 0) {
            var force = (1 - md / REPEL_DIST) * REPEL_STR;
            n.vx += (mx / md) * force;
            n.vy += (my / md) * force;
          }

          // Damping
          n.vx *= DAMPING;
          n.vy *= DAMPING;

          // Speed cap
          var speed = Math.sqrt(n.vx * n.vx + n.vy * n.vy);
          if (speed > SPEED_CAP) { n.vx *= SPEED_CAP / speed; n.vy *= SPEED_CAP / speed; }

          n.x += n.vx;
          n.y += n.vy;

          // Soft boundary: spring back from edges instead of hard bounce
          var pad = 10;
          if (n.x < pad)                   n.vx += (pad - n.x) * 0.05;
          if (n.x > canvas.width  - pad)   n.vx += (canvas.width  - pad - n.x) * 0.05;
          if (n.y < pad)                   n.vy += (pad - n.y) * 0.05;
          if (n.y > canvas.height - pad)   n.vy += (canvas.height - pad - n.y) * 0.05;
        }
      }

      function loop() { update(); draw(); requestAnimationFrame(loop); }

      hero.addEventListener('mousemove', function (e) {
        var rect = canvas.getBoundingClientRect();
        mouse.x = e.clientX - rect.left;
        mouse.y = e.clientY - rect.top;
      });
      hero.addEventListener('mouseleave', function () { mouse.x = -9999; mouse.y = -9999; });
      window.addEventListener('resize', resize);

      init();
      loop();
    })();
  </script>

  <script>
    (function () {
      var REPO = 'MichaelAJH/field-atlas-releases';
      var API  = 'https://api.github.com/repos/' + REPO + '/releases/latest';

      // Map file extensions to button IDs
      var EXT_MAP = { '.dmg': 'dl-mac', '.exe': 'dl-win', '.AppImage': 'dl-linux' };

      // Detect user OS and highlight matching button
      var ua = navigator.userAgent || navigator.platform || '';
      var detectedId = /Mac/i.test(ua) ? 'dl-mac'
                     : /Win/i.test(ua) ? 'dl-win'
                     : /Linux/i.test(ua) ? 'dl-linux'
                     : 'dl-mac';
      var el = document.getElementById(detectedId);
      if (el) el.classList.add('btn-primary');

      function formatSize(bytes) {
        if (bytes >= 1e9) return (bytes / 1e9).toFixed(1) + ' GB';
        if (bytes >= 1e6) return (bytes / 1e6).toFixed(0) + ' MB';
        return bytes + ' B';
      }

      fetch(API)
        .then(function (r) { return r.json(); })
        .then(function (release) {
          // Update version note
          var note = document.getElementById('version-note');
          if (note && release.tag_name) {
            note.innerHTML = 'Latest: <strong>' + release.tag_name + '</strong> (beta) &middot; Free &middot; '
              + '<a href="https://github.com/' + REPO + '/releases">All releases</a>';
          }

          // Update each download button with direct asset URL and size
          (release.assets || []).forEach(function (asset) {
            var name = asset.name || '';
            Object.keys(EXT_MAP).forEach(function (ext) {
              if (name.endsWith(ext)) {
                var btn = document.getElementById(EXT_MAP[ext]);
                if (btn) {
                  btn.href = asset.browser_download_url;
                  var label = ext === '.dmg' ? 'macOS' : ext === '.exe' ? 'Windows' : 'Linux';
                  btn.textContent = label + ' (' + ext.slice(1) + ') \u2014 ' + formatSize(asset.size);
                }
              }
            });
          });
        })
        .catch(function () { /* fallback: buttons still link to /releases/latest */ });
    })();
  </script>

</body>
</html>
